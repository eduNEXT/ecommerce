{% extends 'edx/base.html' %}
{% load i18n %}
{% load staticfiles %}

{% block title %}
    {{ page_title }}
{% endblock title %}

{% block javascript %}
    <script src="{% static 'js/apps/receipt_app.js' %}"></script>
{% endblock javascript %}

{% block navbar %}
    {% include 'edx/partials/_student_navbar.html' %}
{% endblock navbar %}

{% block content %}
<div class="receipt">
  {% if error_text %}
    <div id="error-container">
        <div class="error-message container">
          <h3 class="title">
              <span class="sr">{% blocktrans %} {{ error_summary }} {% endblocktrans %}</span>
              {{ error_summary }}
          </h3>
          <div class="copy">
              <p>{% blocktrans %} {{ error_text }} {% endblocktrans %}</p>
              <br/>
          </div>
          <div class="msg">
              <p>{% autoescape off %}{% blocktrans %} {{ for_help_text }}
              {% endblocktrans %}{% endautoescape %}</p>
          </div>
        </div>
    </div>
  {% else %}
    <div class="container content-container">
        <div id="receipt-container"
          class="pay-and-verify hidden"
          data-is-payment-complete="{{ is_payment_complete }}"
          data-platform-name="{{ platform_name }}"
          data-verified="{{ verified }}"
          data-username="{{ name }}"
          data-lms-url="{{ lms_url }}">
        <div class="wrapper-content-main">
          <article class="content-main">
            <h3 class="title">
              {% trans "Order Complete" %}
            </h3>

            {% if receipt %}
            <div class="list-info">
              <div class="info-item payment-info row">
                <div class="copy col-md-8">
                    <div class="confirm-message">
                        {% trans "Your order is now complete. This page serves as your receipt. You will also receive a confirmation message at" %}
                        <a class="nav-link" href="mailto:{{ receipt.email }}">{{ receipt.email }}</a>.
                    </div>
                </div>

                <div class="wrapper-report col-xs-12">
                    <h4 class="order-headers">{% trans "Order Summary" %}</h4>
                    <div class="order-details">
                        <p class="order-details-text">{% trans "Order" %} {{ receipt.order_number }}</p>
                        <p class="order-details-text">{% trans "Date ordered:" %} {{ receipt.purchased_datetime }}</p>
                        {% for voucher in receipt.vouchers %}
                            <p class="order-details-text">{% trans "Code applied" %} {{ voucher.code }}</p>
                        {% endfor %}
                    </div>
                    <div class="table-responsive">
                      <table class="table">
                          <tbody>
                            {% for item in receipt.items %}
                              <tr>
                                <td>{{ item.description }}</td>
                                <td class="price">{{ item.cost }} ({{ receipt.currency }})</td>
                              </tr>
                            {% endfor %}
                            <tr class="final-price">
                                <td>{% trans "Total" %}</td>
                                <td class="price">{{ receipt.total_cost }} ({{ receipt.currency }})</td>
                            </tr>
                          </tbody>
                      </table>
                    </div>
                    {% if receipt.billed_to %}
                        <div class="payment-summary row">
                            <div class="payment-card-detailss col-sm-4">
                                <h4 class="order-headers">{% trans "Payment Summary" %}</h4>
                                <div class="payment-data">
                                    <p class="payment-user-data">{{ receipt.billed_to.payer_info.shipping_address.recipient_name }}</p>
                                    <p class="payment-user-data">{{ receipt.billed_to.payer_info.shipping_address.line1 }}</p>
                                    <p class="payment-user-data">{{ receipt.billed_to.payer_info.shipping_address.city }}, {{ receipt.billed_to.payer_info.shipping_address.state }} {{ receipt.billed_to.payer_info.shipping_address.postal_code }}</p>
                                </div>
                            </div>
                            <!-- TO  DO
                            <div class="payment-card-details col-sm-8">
                                <p class="payment-card-number">Paid with Mastercard (xxxx-xxxx-xxxx-1234)</p>
                            </div>
                            -->
                        </div>
                    {% endif %}
                  {% if receipt.is_refunded %}
                      <div class="msg msg-refunds">
                        <h4 class="title sr">{% trans "Please Note" %}: </h4>
                        <div class="copy">
                          <p>{% trans "Crossed out items have been refunded." %}</p>
                        </div>
                      </div>
                  {% endif %}
                </div>

                {% if provider_data %}
                <div class="report-receipt-provider row" id="receipt-provider">
                  <div class="provider-wrapper col-md-9">
                    <div class="provider-info">
                      {% blocktrans %}
                      You still need to visit the {{ provider_data.display_name }} website to complete the credit process.
                      {% endblocktrans %}
                    </div>
                    <div class="provider-more-info">
                      {% blocktrans %}
                      To finalize course credit, {{ provider_data.display_name }} requires {{ platform_name }} learners  to submit a credit request.
                      {% endblocktrans %}
                    </div>
                    <div class="provider-instructions">
                      {{ provider_data.fulfillment_instructions }}
                    </div>
                  </div>

                  <div class="provider-buttons-logos col-md-3">
                    <div class="provider-logo">
                      <img src='{{ provider_data.thumbnail_url }}' alt='{{ provider_data.display_name }}' />
                    </div>
                      <a id="credit-button"
                        class="complete-course btn-neutral"
                        data-course-key="{{ course.key }}"
                        data-provider="{{ provider_data.id }}"
                        data-track-category="credit"
                        data-track-event="edx.bi.credit.clicked_complete_credit"
                        data-track-label="{{ course.key }}"
                        data-track-type="click"
                        data-username="{{ username }}"
                        href="{{ provider_data.url }}">
                        {% trans  "Get Credit" %}
                      </a>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
            {% else %}
                <p class="no-content">{% trans "No receipt available" %}</p>
            {% endif %}

            <div class="nav-wizard row">
                {% if not is_verification_required or verified %}
                    <div id="verify_choices"><a class="verify-later nav-link" href="{{ lms_url }}/dashboard">
                    {% trans "Go to Dashboard" %}</a></div>
                {% else %}
                    <div class="col-md-9">
                        <p class="verify-message-header">{% trans "Identity Verification Required." %}</p>
                        <p class="verify-message">
                            {% blocktrans %}
                            Before you can receive a certificate for this course, you must verify your identity using a <span class="bolded-text">webcam</span> and a <span class="bolded-text">government-issued photo identification</span>, such as a driverâ€™s license or passport. Different courses have different verification deadlines, so edX encourages you to complete this step as soon as possible.
                            {% endblocktrans %}
                        </p>
                    </div>
                    <div id="verify_choices" class="right col-md-3">
                        <div id="verify_now">
                          <a id="verify_now_button"
                            class="next action-primary"
                            data-track-category="verification"
                            data-track-event="edx.bi.user.verification.deferred"
                            data-track-type="click"
                            href="{{ lms_url }}/verify_student/verify-now/{{ course.key }}/">
                            {% trans "Verify ID Now" %}
                          </a>
                        </div>
                        <a id="verify_later_button"
                          class="verify-later"
                          data-track-category="verification"
                          data-track-event="edx.bi.user.verification.immediate"
                          data-track-type="click"
                          href="{{ lms_url }}/dashboard">
                          {% trans "Verify later" %}
                        </a>
                    </div>
                {% endif %}
            </div>
          </article>
        </div>

        </div>
    </div>
  {% endif %}
</div>
{% endblock content %}
